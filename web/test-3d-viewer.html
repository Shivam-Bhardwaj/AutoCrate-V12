<!DOCTYPE html>
<html>
<head>
    <title>3D Viewer Test</title>
    <style>
        body { margin: 0; padding: 20px; font-family: Arial; }
        .container { max-width: 1200px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        #log { background: #f5f5f5; padding: 10px; margin-top: 20px; min-height: 200px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>AutoCrate 3D Viewer Diagnostic</h1>
        
        <div id="status" class="status info">Checking components...</div>
        
        <div>
            <button onclick="testCalculation()">Test Calculation</button>
            <button onclick="test3DViewer()">Test 3D Viewer</button>
            <button onclick="testGenerateButton()">Test Generate Button</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
        
        <div id="log">
            <h3>Console Log:</h3>
            <pre id="logContent"></pre>
        </div>
    </div>

    <script>
        let logContent = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${type.toUpperCase()}: ${message}`;
            logContent.push(entry);
            document.getElementById('logContent').textContent = logContent.join('\n');
            console.log(message);
        }
        
        function clearLog() {
            logContent = [];
            document.getElementById('logContent').textContent = '';
        }
        
        async function testCalculation() {
            log('Testing calculation functionality...');
            try {
                const response = await fetch('http://localhost:3001');
                if (response.ok) {
                    log('Server is running', 'success');
                    
                    // Check if calculation endpoint exists
                    log('Checking calculation logic...');
                    // This would normally trigger the calculation
                    log('Calculation test would trigger here', 'info');
                    
                    document.getElementById('status').className = 'status success';
                    document.getElementById('status').textContent = 'Calculation test ready';
                } else {
                    throw new Error('Server not responding');
                }
            } catch (error) {
                log(`Error: ${error.message}`, 'error');
                document.getElementById('status').className = 'status error';
                document.getElementById('status').textContent = 'Server error - check if dev server is running';
            }
        }
        
        function test3DViewer() {
            log('Testing 3D viewer components...');
            
            // Check for WebGL support
            const canvas = document.createElement('canvas');
            const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
            
            if (gl) {
                log('WebGL is supported', 'success');
            } else {
                log('WebGL is NOT supported', 'error');
            }
            
            // Check for Three.js availability
            if (typeof window.THREE !== 'undefined') {
                log('Three.js is loaded', 'success');
            } else {
                log('Three.js needs to be loaded via React components', 'info');
            }
            
            log('3D Viewer test complete');
        }
        
        function testGenerateButton() {
            log('Testing Generate button functionality...');
            
            // Simulate button click
            log('Simulating Generate button click...');
            log('Would download NX expression file', 'info');
            log('Would generate PDF report', 'info');
            
            // Check if download functionality exists
            const testBlob = new Blob(['test content'], { type: 'text/plain' });
            const url = URL.createObjectURL(testBlob);
            
            if (url) {
                log('Blob creation successful', 'success');
                URL.revokeObjectURL(url);
            } else {
                log('Blob creation failed', 'error');
            }
            
            log('Generate button test complete');
        }
        
        // Initial check
        window.onload = () => {
            log('Page loaded, running diagnostics...');
            
            // Check browser features
            if (window.WebGLRenderingContext) {
                log('WebGL API available', 'success');
            }
            
            if (window.Blob) {
                log('Blob API available', 'success');
            }
            
            if (window.URL && window.URL.createObjectURL) {
                log('URL.createObjectURL available', 'success');
            }
            
            document.getElementById('status').className = 'status success';
            document.getElementById('status').textContent = 'Diagnostics ready - click buttons to test';
        };
    </script>
</body>
</html>